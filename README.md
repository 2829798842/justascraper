# 青岛人社局通知公告爬虫项目

## 项目概述
一个简单的网络爬虫

## 目标网址
https://hrss.qingdao.gov.cn/ztzl_47/zcpd_47/tzgg_47/

## 项目功能
- 定期爬取目标网页的通知公告信息
- 检测是否有新的通知发布
- 当有新通知时提供通知机制（控制台输出、邮件、文件记录等）
- 数据持久化存储，避免重复通知

## 技术栈
- Python 3.x
- requests - HTTP请求库
- BeautifulSoup4 - HTML解析库
- json - 数据存储
- datetime - 时间处理
- schedule - 定时任务（可选）

## 项目结构
```
rensheju/
├── README.md              # 项目说明文档
├── requirements.txt       # 依赖包列表
├── scraper.py            # 主爬虫脚本
├── config.py             # 配置文件
├── data/                 # 数据存储目录
│   └── announcements.json # 历史通知数据
├── logs/                 # 日志目录
│   └── scraper.log       # 运行日志
└── utils/                # 工具函数目录
    ├── __init__.py
    ├── parser.py         # HTML解析工具
    ├── notifier.py       # 通知工具
    └── storage.py        # 数据存储工具
```

## 实施步骤

### 阶段一：环境准备和基础爬虫 ✅
- [x] 创建项目README文档
- [x] 创建requirements.txt
- [x] 创建基础的爬虫脚本
- [x] 实现网页内容获取功能
- [x] 测试基本的网页访问

### 阶段二：数据解析和存储 ✅
- [x] 分析目标页面HTML结构
- [x] 实现通知公告信息提取
- [x] 设计数据存储格式
- [x] 实现数据持久化存储
- [x] 创建数据存储目录结构

### 阶段三：新通知检测 ✅
- [x] 实现历史数据对比功能
- [x] 设计新通知检测算法
- [x] 实现通知去重机制
- [x] 测试新通知检测功能

### 阶段四：通知机制 ✅
- [x] 实现控制台通知
- [x] 实现文件日志记录
- [x] 实现邮件通知
- [x] 实现企业微信通知
- [x] 实现钉钉通知
- [x] 实现Telegram通知

### 阶段五：定时任务和优化 ✅
- [x] 实现定时执行功能
- [x] 添加错误处理和重试机制
- [x] 添加日志记录功能
- [x] 性能优化和代码重构
- [x] 守护进程稳定性优化

### 阶段六：测试和部署 ✅
- [x] 功能测试
- [x] 异常情况测试
- [x] 编写使用说明
- [x] 部署和运行指南
- [x] 通知配置助手

## 数据格式设计

### 通知公告数据结构
```json
{
  "announcements": [
    {
      "id": "unique_identifier",
      "title": "通知标题",
      "date": "2025-01-20",
      "url": "详情链接",
      "content_preview": "内容预览",
      "scraped_at": "2025-01-20 10:30:00",
      "is_new": true
    }
  ],
  "last_check": "2025-01-20 10:30:00",
  "total_count": 10
}
```

## 配置说明

### 基础配置参数
- 目标URL
- 爬取频率（默认：每小时检查一次）
- 数据存储路径
- 日志级别
- 通知方式配置

## 快速开始

### 1. 环境准备
```bash
# 创建并激活虚拟环境
uv venv
.venv\Scripts\activate

# 安装依赖
uv pip install requests beautifulsoup4 lxml schedule
```

### 2. 配置通知方式（可选）
```bash
# 运行配置助手
python setup_notification.py
```
示运行状态

### 3. 运行爬虫

#### 执行一次检查
```bash
python scraper.py --once
```

#### 启动长期监控（推荐）
```bash
python scraper.py --daemon
```

### 4. 运行效果

**首次运行**：
- 🔍 爬取当前所有通知公告
- 💾 建立基础数据库
- ✅ 完成初始化

**后续运行**：
- 🔔 自动检测新发布的通知
- 📱 通过配置的方式推送通知
- 📊 维护历史数据记录

**守护进程模式**：
- ⏰ 每10分钟自动检查一次
- 🔄 自动错误恢复和重试
- 📈 详细的运行日志记录
- 🛡️ 网络异常保护机制

## 注意事项
1. 遵守网站的robots.txt规则
2. 合理设置请求频率，避免对目标服务器造成压力
3. 处理网络异常和解析错误
4. 定期备份数据文件
5. 监控爬虫运行状态

## 法律声明
本项目仅用于学习和个人使用，请遵守相关法律法规和网站使用条款。

## 更新日志
- 2025-08-04 16:48: **🎉 项目完成！** 
  - ✅ 完成所有核心功能开发
  - ✅ 实现多种消息推送方式
  - ✅ 优化守护进程稳定性
  - ✅ 添加通知配置助手
  - ✅ 完善文档和使用说明
- 2025-08-04 16:32: 基础爬虫功能测试成功
- 2025-08-04 16:06: 创建项目规划文档

## 项目状态：🟢 完成
所有计划功能已实现并测试通过，可投入正式使用。

## 技术支持
如遇到使用问题，请检查：
1. 网络连接是否正常
2. 目标网站是否可正常访问  
3. 通知配置是否正确
4. 虚拟环境是否正确激活
5. 日志文件中的详细错误信息